#!/bin/bash
# Corrige a vulnerabilidade de transmissão de dados sensíveis via HTTP
sed -i 's/^#*Listen 80$/Listen 443/' /etc/apache2/ports.conf
sed -i 's/^#*<VirtualHost \*:80>/<VirtualHost \*:443>/' /etc/apache2/sites-available/000-default.conf
a2enmod ssl
systemctl restart apache2

# Corrige a vulnerabilidade de DNS Cache Snooping
sed -i 's/^recursion yes;/recursion no;/' /etc/bind/named.conf.options
systemctl restart bind9

# Corrige a vulnerabilidade de ICMP Timestamp Reply
echo "net.ipv4.icmp_echo_ignore_all=1" >> /etc/sysctl.conf
sysctl -p

# Corrige a vulnerabilidade de TLSv1.0 e TLSv1.1
sed -i 's/^SSLProtocol all -SSLv3$/SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1/' /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Corrige a vulnerabilidade de Renegotiation DoS
sed -i 's/^SSLHonorCipherOrder off$/SSLHonorCipherOrder on/' /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Corrige a vulnerabilidade de Weak Cipher Suites
sed -i 's/^SSLCipherSuite HIGH:!aNULL$/SSLCipherSuite HIGH:!aNULL:!MD5:!RC4:!DES:!3DES/' /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Corrige a vulnerabilidade de TCP Timestamps
echo "net.ipv4.tcp_timestamps=0" >> /etc/sysctl.conf
sysctl -p