#!/bin/bash

# Vulnerabilidade 1: Cleartext Transmission of Sensitive Information via HTTP
sed -i 's/^#*\s*Listen 80$/Listen 443/' /etc/apache2/ports.conf
sed -i 's/^#*\s*<VirtualHost \*:80>/<VirtualHost *:80>\n    Redirect permanent \/ https:\/\/${HOSTNAME}\//' /etc/apache2/sites-available/000-default.conf
a2enmod ssl
systemctl restart apache2

# Vulnerabilidade 2: DNS Cache Snooping Vulnerability (UDP)
sed -i 's/^\(options .*\)/\1\n\trecursion no;/' /etc/bind/named.conf.options
systemctl restart bind9

# Vulnerabilidade 3: ICMP Timestamp Reply Information Disclosure
echo "net.ipv4.icmp_echo_ignore_all = 1" >> /etc/sysctl.conf
sysctl -p

# Vulnerabilidade 4: SSL/TLS: Deprecated TLSv1.0 and TLSv1.1 Protocol Detection
sed -i 's/^SSLProtocol.*/SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1/' /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Vulnerabilidade 5: SSL/TLS: Renegotiation DoS Vulnerability
sed -i 's/^SSLProtocol.*/SSLProtocol all -SSLv2 -SSLv3/' /etc/apache2/mods-enabled/ssl.conf
echo "SSLInsecureRenegotiation off" >> /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Vulnerabilidade 6: SSL/TLS: Report Weak Cipher Suites
sed -i 's/^SSLCipherSuite.*/SSLCipherSuite HIGH:!aNULL:!MD5:!RC4/' /etc/apache2/mods-enabled/ssl.conf
systemctl restart apache2

# Vulnerabilidade 7: TCP Timestamps Information Disclosure
echo "net.ipv4.tcp_timestamps = 0" >> /etc/sysctl.conf
sysctl -p