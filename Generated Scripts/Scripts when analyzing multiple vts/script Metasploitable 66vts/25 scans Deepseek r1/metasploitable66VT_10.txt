```bash
#!/usr/bin/env bash

set -euo pipefail

# Redefinir senha do MySQL
MYSQL_NEW_PASS=$(openssl rand -base64 16)
mysql -u root <<-EOF
UPDATE mysql.user SET authentication_string=PASSWORD('$MYSQL_NEW_PASS') WHERE User='root';
FLUSH PRIVILEGES;
EOF

# Redefinir senha do PostgreSQL
PG_NEW_PASS=$(openssl rand -base64 16)
su - postgres -c "psql -c \"ALTER USER postgres WITH PASSWORD '$PG_NEW_PASS';\""

# Lista de serviços para desativar
declare -a disable_services=(
    "rlogin"
    "rsh"
    "rexec"
    "telnet"
    "ingreslock"
    "druby"
)

for service in "${disable_services[@]}"; do
    pkill -9 -f "$service" || true
    rm -f "/etc/xinetd.d/$service" || true
    sed -i "/$service/d" /etc/inetd.conf
done

# Configurações do SSH
SSHD_CONFIG="/etc/ssh/sshd_config"
sed -i '/^KexAlgorithms/d;/^Ciphers/d;/^MACs/d' "$SSHD_CONFIG"
echo 'KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,diffie-hellman-group18-sha512' >> "$SSHD_CONFIG"
echo 'Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com' >> "$SSHD_CONFIG"
echo 'MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com' >> "$SSHD_CONFIG"
systemctl restart ssh || service ssh restart

# Correções para Tomcat
rm -f /usr/share/tomcat*/conf/server.xml /etc/tomcat*/server.xml
touch /usr/share/tomcat*/conf/server.xml /etc/tomcat*/server.xml

# Correções para VNC
vncpasswd -u
update-rc.d vncserver disable || chkconfig vncserver off

# Correções para FTP
sed -i '/anonymous_enable/d' /etc/vsftpd.conf
echo 'anonymous_enable=NO' >> /etc/vsftpd.conf
service vsftpd restart || true

# Correções para Apache
a2dismod cgi || true
rm -f /etc/apache2/mods-enabled/cgi.load
rm -rf /doc
apache2ctl restart || httpd -k restart

# Correções para PHP
find /var/www/ -name 'phpinfo.php' -delete

# Impedir scripts CGI perigosos
rm -f /usr/lib/cgi-bin/php*
rm -f /cgi-bin/php*

# Atualizar certificados expirados e regenerar com SHA-256
rm -f /etc/ssl/*.key /etc/ssl/*.crt
openssl req -x509 -newkey rsa:4096 -sha256 -days 730 -nodes \
    -out /etc/ssl/server.crt -keyout /etc/ssl/server.key \
    -subj "/CN=${HOSTNAME}"

# Configurar tempo máximo de exclusão para entrada TCP
sysctl -w net.ipv4.tcp_fin_timeout=15
echo "net.ipv4.tcp_fin_timeout=15" >> /etc/sysctl.conf

# Desabilitar protocolos vulneráveis
openssl_conf="/etc/ssl/openssl.cnf"
grep -q 'MinProtocol' "$openssl_conf" || \
    echo 'MinProtocol = TLSv1.2' >> "$openssl_conf"
grep -q 'CipherString' "$openssl_conf" || \
    echo 'CipherString = DEFAULT@SECLEVEL=2' >> "$openssl_conf"

# Desativar SSLv3 e TLS inferiores via system-wide
echo 'SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1' > /etc/ssl/openssl-custom.conf
cat /etc/ssl/openssl.conf /etc/ssl/openssl-custom.conf > /etc/ssl/openssl.cnf.new
mv /etc/ssl/openssl.cnf.new /etc/ssl/openssl.cnf
```