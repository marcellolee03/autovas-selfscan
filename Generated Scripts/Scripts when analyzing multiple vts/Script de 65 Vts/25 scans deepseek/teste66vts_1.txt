#!/bin/bash

# Verifica se o sistema é Windows
if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" ]]; then
    echo "Este script é destinado a sistemas Linux. Por favor, use um sistema compatível."
    exit 1
fi

# Atualiza o Python para versões seguras
sudo apt-get update
sudo apt-get install -y python3.10 python3.12

# Instala versões específicas seguras
sudo apt-get install -y python3.10=3.10.16-1~22.04 python3.12=3.12.9-1~22.04

# Remove versões vulneráveis
sudo apt-get purge -y python3.10.12 python3.12.0

# Atualiza o pip
python3.10 -m pip install --upgrade pip
python3.12 -m pip install --upgrade pip

# Configura padrão para Python 3.12
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.12 2

# Ajusta certificados SSL
sudo update-ca-certificates

# Configura MAC algorithms para SSH
sudo sed -i 's/^MACs .*/MACs hmac-sha2-512,hmac-sha2-256,hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com/' /etc/ssh/sshd_config

# Reinicia o serviço SSH
sudo systemctl restart ssh

# Desabilita TLS 1.0 e 1.1
sudo sed -i 's/^Protocol .*/Protocol 2/' /etc/ssh/sshd_config
sudo sed -i 's/^Ciphers .*/Ciphers aes256-ctr,aes192-ctr,aes128-ctr/' /etc/ssh/sshd_config
sudo systemctl restart sshd

echo "Correções aplicadas com sucesso!"