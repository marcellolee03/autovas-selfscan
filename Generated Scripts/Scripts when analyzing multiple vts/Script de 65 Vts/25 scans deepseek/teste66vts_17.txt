#!/bin/bash

UPGRADE_VERSIONS="3.8.20 3.9.20 3.10.16 3.11.11 3.12.9 3.13.2"

PYTHON_VERSIONS=($(python3 --version 2>&1 | awk '{print $2}'))

for version in "${PYTHON_VERSIONS[@]}"; do
  for upgrade_version in $UPGRADE_VERSIONS; do
    if [[ "$version" < "$upgrade_version" ]]; then
      sudo apt-get update
      sudo apt-get install -y python$version python$version-dev python$version-venv
      sudo apt-get upgrade -y python$version
    fi
  done
done

for port in 5000 8000 8001 8002; do
  sudo netstat -tuln | grep $port > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    sudo fuser -k $port/tcp
  fi
done

echo "ssl_protocols = TLSv1.2 TLSv1.3" | sudo tee /etc/ssl/openssl.cnf > /dev/null

sudo sed -i 's/umac-64-etm@openssh.com//g' /etc/ssh/sshd_config
sudo sed -i 's/umac-64@openssh.com//g' /etc/ssh/sshd_config
sudo systemctl restart sshd

sudo sysctl -w net.ipv4.icmp_echo_ignore_all=1

sudo update-ca-certificates --fresh

exit 0