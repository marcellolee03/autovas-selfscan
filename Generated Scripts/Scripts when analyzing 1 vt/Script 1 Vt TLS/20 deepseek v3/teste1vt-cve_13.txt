#!/bin/bash
CONFIG_FILE="/etc/ssl/openssl.cnf"
BACKUP_FILE="/etc/ssl/openssl.cnf.bak"
CIPHERS="ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305"

cp $CONFIG_FILE $BACKUP_FILE

sed -i '/^MinProtocol = .*/d' $CONFIG_FILE
sed -i '/^CipherString = .*/d' $CONFIG_FILE

echo "MinProtocol = TLSv1.2" >> $CONFIG_FILE
echo "CipherString = DEFAULT@SECLEVEL=2:$CIPHERS" >> $CONFIG_FILE

systemctl restart apache2
systemctl restart postgresql