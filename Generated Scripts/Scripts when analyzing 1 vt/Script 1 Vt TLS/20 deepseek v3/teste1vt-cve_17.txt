#!/bin/bash
TLS_CONF="/etc/ssl/openssl.cnf"
BACKUP_DIR="/etc/ssl/backup"
CURRENT_DATE=$(date +%Y%m%d%H%M%S)

mkdir -p "$BACKUP_DIR"
cp "$TLS_CONF" "${BACKUP_DIR}/openssl.cnf.backup.${CURRENT_DATE}"

sed -i '/^MinProtocol = TLSv1.0$/d' "$TLS_CONF"
sed -i '/^MinProtocol = TLSv1.1$/d' "$TLS_CONF"
sed -i '/^CipherString = DEFAULT$/d' "$TLS_CONF"

echo "MinProtocol = TLSv1.2" >> "$TLS_CONF"
echo "CipherString = DEFAULT@SECLEVEL=2" >> "$TLS_CONF"

systemctl restart apache2
systemctl restart postgresql