#!/bin/bash

if [ "$EUID" -ne 0 ]; then
    echo "Erro: Este script precisa ser executado como root." >&2
    exit 1
fi

if ! dpkg-query -W -f='${Status}' apache2 2>/dev/null | grep -q "ok installed"; then
    exit 0
fi

VERSION=$(dpkg-query -W -f='${Version}' apache2 2>/dev/null)

if dpkg --compare-versions "$VERSION" ge '2.2.0' && dpkg --compare-versions "$VERSION" le '2.2.21'; then
    export DEBIAN_FRONTEND=noninteractive
    apt-get update -y
    apt-get install --only-upgrade -y apache2
fi