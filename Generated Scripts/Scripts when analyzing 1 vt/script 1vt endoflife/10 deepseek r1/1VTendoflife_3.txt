#!/bin/bash
export DEBIAN_FRONTEND=noninteractive
OLD_VERSION="8.04"
SUPPORTED_VERSION="20.04"  # Target a supported LTS version
REPOSITORY="http://old-releases.ubuntu.com/ubuntu"

# Verify current Ubuntu version
CURRENT_VERSION="$(lsb_release -cs)"
[ "$CURRENT_VERSION" = "hardy" ] || { echo "Invalid OS version"; exit 1; }

# Update sources.list
sed -i "s/^deb .*ubuntu.com.*/deb $REPOSITORY\/ubuntu\/ hardy main restricted universe multiverse/" /etc/apt/sources.list
sed -i "1ideb $REPOSITORY\/ubuntu\/ hardy-updates main restricted universe multiverse" /etc/apt/sources.list
sed -i "1ideb $REPOSITORY\/ubuntu\/ hardy-security main restricted universe multiverse" /etc/apt/sources.list

# Prepare system
apt-get update -y
apt-get upgrade -y
apt-get dist-upgrade -y
apt-get install -y update-manager-core
apt-get autoremove -y
apt-get clean

# Iteratively upgrade through each release
for VERSPEC in $(ubuntu-dist-upgrade-path.sh hardy); do
    sed -i "s/hardy/$VERSPEC/g" /etc/apt/sources.list
    sed -i "s|http://.*ubuntu.com|$REPOSITORY|g" /etc/apt/sources.list
    apt-get update -y && apt-get dist-upgrade -yq
    apt-get autoremove -y
done

# Final cleanup
rm -rf /var/lib/apt/lists/*
reboot