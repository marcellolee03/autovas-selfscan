#!/bin/bash
# Ensure the web server enforces HTTPS for sensitive data transmission

# Check if Apache is installed
if command -v apache2 &> /dev/null; then
    # Backup the original configuration file
    cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/000-default.conf.bak

    # Modify the Apache configuration to redirect HTTP to HTTPS
    sed -i 's/<VirtualHost \*:80>/<VirtualHost \*:80>\n    Redirect permanent \/ https:\/\/$host\//' /etc/apache2/sites-available/000-default.conf

    # Enable SSL module and default SSL site
    a2enmod ssl
    a2ensite default-ssl

    # Restart Apache to apply changes
    systemctl restart apache2
fi

# Check if Nginx is installed
if command -v nginx &> /dev/null; then
    # Backup the original configuration file
    cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

    # Modify the Nginx configuration to redirect HTTP to HTTPS
    sed -i 's/listen 80 default_server;/listen 80 default_server;\n    return 301 https:\/\/$host$request_uri;/' /etc/nginx/sites-available/default

    # Enable SSL for Nginx
    sed -i 's/# listen 443 ssl default_server;/listen 443 ssl default_server;/' /etc/nginx/sites-available/default
    sed -i 's/# include snippets\/snakeoil.conf;/include snippets\/snakeoil.conf;/' /etc/nginx/sites-available/default

    # Restart Nginx to apply changes
    systemctl restart nginx
fi

# Ensure that the web server is enforcing HTTPS
echo "HTTPS enforcement has been configured successfully."