#!/bin/bash

# Define as variáveis
TARGET_FILE="/console/framework/../js/jquery-1.8.3.min.js"
BACKUP_DIR="/tmp/jquery_backup"
NEW_VERSION_URL="https://code.jquery.com/jquery-1.9.0.min.js"

# Cria o diretório de backup se não existir
mkdir -p "$BACKUP_DIR"

# Faz o backup do arquivo vulnerável
if [ -f "$TARGET_FILE" ]; then
  cp "$TARGET_FILE" "$BACKUP_DIR/jquery-1.8.3.min.js.bak"
  echo "Backup do arquivo original criado em: $BACKUP_DIR/jquery-1.8.3.min.js.bak"
else
  echo "Arquivo vulnerável não encontrado: $TARGET_FILE"
  exit 1
fi

# Baixa a nova versão do jQuery
wget -q "$NEW_VERSION_URL" -O "$TARGET_FILE"

# Verifica se o download foi bem-sucedido
if [ -f "$TARGET_FILE" ]; then
  echo "jQuery atualizado para a versão 1.9.0 com sucesso."
else
  echo "Falha ao baixar a nova versão do jQuery."
  # Restaura o backup
  if [ -f "$BACKUP_DIR/jquery-1.8.3.min.js.bak" ]; then
    cp "$BACKUP_DIR/jquery-1.8.3.min.js.bak" "$TARGET_FILE"
    echo "Backup restaurado para: $TARGET_FILE"
  fi
  exit 1
fi

exit 0
