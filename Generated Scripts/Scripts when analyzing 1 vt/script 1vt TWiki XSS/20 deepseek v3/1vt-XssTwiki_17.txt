#!/bin/bash
TWIKI_DIR="/var/www/html/twiki"
BACKUP_DIR="/var/backups/twiki"
LATEST_VERSION="4.2.4"
DOWNLOAD_URL="https://sourceforge.net/projects/twiki/files/TWiki/TWiki%20$LATEST_VERSION/TWiki-$LATEST_VERSION.tgz"

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/twiki_backup_$(date +%F).tar.gz -C $TWIKI_DIR .

wget $DOWNLOAD_URL -O /tmp/twiki-$LATEST_VERSION.tgz
tar -xzf /tmp/twiki-$LATEST_VERSION.tgz -C /tmp

rm -rf $TWIKI_DIR/*
cp -r /tmp/TWiki-$LATEST_VERSION/* $TWIKI_DIR/

chown -R www-data:www-data $TWIKI_DIR
chmod -R 755 $TWIKI_DIR

rm -rf /tmp/TWiki-$LATEST_VERSION /tmp/twiki-$LATEST_VERSION.tgz

systemctl restart apache2